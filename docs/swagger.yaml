basePath: /api/v1
definitions:
  domain.Ride:
    properties:
      accepted_at:
        type: string
      cancelled_at:
        type: string
      completed_at:
        type: string
      customer_id:
        type: integer
      driver_id:
        type: integer
      dropoff_lat:
        type: number
      dropoff_lng:
        type: number
      fare:
        type: number
      id:
        type: integer
      pickup_lat:
        type: number
      pickup_lng:
        type: number
      requested_at:
        type: string
      started_at:
        type: string
      status:
        $ref: '#/definitions/domain.RideStatus'
    type: object
  domain.RideStatus:
    enum:
    - requested
    - pending
    - accepted
    - started
    - completed
    - cancelled
    type: string
    x-enum-comments:
      RideStatusPending: Alternative status for requested rides
    x-enum-descriptions:
    - ""
    - Alternative status for requested rides
    - ""
    - ""
    - ""
    - ""
    x-enum-varnames:
    - RideStatusRequested
    - RideStatusPending
    - RideStatusAccepted
    - RideStatusStarted
    - RideStatusCompleted
    - RideStatusCancelled
  handler.AuthResponse:
    properties:
      customer: {}
      token:
        type: string
    type: object
  handler.DriverInfo:
    properties:
      current_lat:
        description: Driver's current location
        type: number
      current_lng:
        description: Driver's current location
        type: number
      driver_id:
        type: integer
      last_ping_at:
        description: Last location update time
        type: string
      name:
        type: string
      phone:
        type: string
      vehicle_no:
        type: string
    type: object
  handler.ErrorResponse:
    properties:
      error:
        example: Invalid request
        type: string
    type: object
  handler.FindNearestDriversRequest:
    properties:
      latitude:
        type: number
      limit:
        type: integer
      longitude:
        type: number
      radius:
        type: number
    required:
    - latitude
    - longitude
    type: object
  handler.GetNearbyRidesRequest:
    properties:
      lat:
        type: number
      limit:
        description: max number of rides to return, default 50
        type: integer
      lng:
        type: number
      max_distance:
        description: in meters, default 10000
        type: number
    required:
    - lat
    - lng
    type: object
  handler.LoginCustomerRequest:
    properties:
      email:
        type: string
      password:
        type: string
    type: object
  handler.MessageResponse:
    properties:
      message:
        example: Operation completed successfully
        type: string
    type: object
  handler.RegisterCustomerRequest:
    properties:
      email:
        type: string
      name:
        type: string
      password:
        type: string
      phone:
        type: string
    type: object
  handler.RegisterDriverRequest:
    properties:
      name:
        type: string
      phone:
        type: string
      vehicle_no:
        type: string
    type: object
  handler.RequestOTPRequest:
    properties:
      phone:
        type: string
    type: object
  handler.RequestRideRequest:
    properties:
      dropoff_lat:
        type: number
      dropoff_lng:
        type: number
      pickup_lat:
        type: number
      pickup_lng:
        type: number
    type: object
  handler.RideStatusResponse:
    properties:
      accepted_at:
        type: string
      cancelled_at:
        type: string
      completed_at:
        type: string
      customer_id:
        type: integer
      driver:
        allOf:
        - $ref: '#/definitions/handler.DriverInfo'
        description: Driver information (only if ride is accepted/started/completed)
      dropoff_lat:
        type: number
      dropoff_lng:
        type: number
      fare:
        type: number
      pickup_lat:
        type: number
      pickup_lng:
        type: number
      requested_at:
        type: string
      ride_id:
        type: integer
      started_at:
        type: string
      status:
        type: string
    type: object
  handler.UpdateLocationRequest:
    properties:
      latitude:
        type: number
      longitude:
        type: number
    type: object
  handler.VerifyOTPRequest:
    properties:
      otp:
        type: string
      phone:
        type: string
    type: object
  service.RideWithCustomerInfo:
    properties:
      customer_current_lat:
        description: Customer's current location (pickup)
        type: number
      customer_current_lng:
        description: Customer's current location (pickup)
        type: number
      customer_id:
        type: integer
      customer_name:
        type: string
      customer_phone:
        type: string
      distance_from_driver:
        description: in meters
        type: number
      dropoff_lat:
        description: Destination/drop location
        type: number
      dropoff_lng:
        description: Destination/drop location
        type: number
      pickup_lat:
        description: Same as customer current location
        type: number
      pickup_lng:
        description: Same as customer current location
        type: number
      requested_at:
        type: string
      ride_id:
        type: integer
      status:
        type: string
    type: object
host: localhost:8080
info:
  contact:
    email: mohammadkaiom79@gmail.com
    name: Mohammad Kaium
  description: |-
    This is a comprehensive Ride Engine API server for managing customers, drivers, and rides.
    The API provides endpoints for user registration, authentication, location tracking, and ride management.
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT
  title: Ride Engine API
  version: "1.0"
paths:
  /customers/login:
    post:
      consumes:
      - application/json
      description: Authenticate a customer with email and password
      parameters:
      - description: Customer login credentials
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/handler.LoginCustomerRequest'
      produces:
      - application/json
      responses:
        "200":
          description: Login successful
          schema:
            $ref: '#/definitions/handler.AuthResponse'
        "400":
          description: Invalid request
          schema:
            $ref: '#/definitions/handler.ErrorResponse'
        "401":
          description: Unauthorized
          schema:
            $ref: '#/definitions/handler.ErrorResponse'
      summary: Login a customer
      tags:
      - Customers
  /customers/register:
    post:
      consumes:
      - application/json
      description: Register a new customer with name, email, phone, and password
      parameters:
      - description: Customer registration details
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/handler.RegisterCustomerRequest'
      produces:
      - application/json
      responses:
        "201":
          description: Customer registered successfully
          schema:
            $ref: '#/definitions/handler.AuthResponse'
        "400":
          description: Invalid request
          schema:
            $ref: '#/definitions/handler.ErrorResponse'
      summary: Register a new customer
      tags:
      - Customers
  /drivers/location:
    post:
      consumes:
      - application/json
      description: Update the current location of the authenticated driver
      parameters:
      - description: Driver's current location
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/handler.UpdateLocationRequest'
      produces:
      - application/json
      responses:
        "200":
          description: Location updated successfully
          schema:
            $ref: '#/definitions/handler.MessageResponse'
        "400":
          description: Invalid request
          schema:
            $ref: '#/definitions/handler.ErrorResponse'
        "401":
          description: Unauthorized
          schema:
            $ref: '#/definitions/handler.ErrorResponse'
        "500":
          description: Internal server error
          schema:
            $ref: '#/definitions/handler.ErrorResponse'
      security:
      - BearerAuth: []
      summary: Update driver location
      tags:
      - Drivers
  /drivers/login/request-otp:
    post:
      consumes:
      - application/json
      description: Send an OTP to the driver's phone number for authentication
      parameters:
      - description: Phone number to send OTP
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/handler.RequestOTPRequest'
      produces:
      - application/json
      responses:
        "200":
          description: OTP sent successfully
          schema:
            $ref: '#/definitions/handler.MessageResponse'
        "400":
          description: Invalid request
          schema:
            $ref: '#/definitions/handler.ErrorResponse'
      summary: Request OTP for driver login
      tags:
      - Drivers
  /drivers/login/verify-otp:
    post:
      consumes:
      - application/json
      description: Verify the OTP sent to driver's phone and authenticate
      parameters:
      - description: Phone and OTP for verification
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/handler.VerifyOTPRequest'
      produces:
      - application/json
      responses:
        "200":
          description: Login successful
          schema:
            $ref: '#/definitions/handler.AuthResponse'
        "400":
          description: Invalid request
          schema:
            $ref: '#/definitions/handler.ErrorResponse'
        "401":
          description: Unauthorized
          schema:
            $ref: '#/definitions/handler.ErrorResponse'
      summary: Verify OTP and login driver
      tags:
      - Drivers
  /drivers/register:
    post:
      consumes:
      - application/json
      description: Register a new driver with name, phone, and vehicle number
      parameters:
      - description: Driver registration details
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/handler.RegisterDriverRequest'
      produces:
      - application/json
      responses:
        "201":
          description: Driver registered successfully
          schema:
            additionalProperties: true
            type: object
        "400":
          description: Invalid request
          schema:
            $ref: '#/definitions/handler.ErrorResponse'
      summary: Register a new driver
      tags:
      - Drivers
  /rides:
    post:
      consumes:
      - application/json
      description: Create a new ride request with pickup and dropoff locations
      parameters:
      - description: Ride request details
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/handler.RequestRideRequest'
      produces:
      - application/json
      responses:
        "201":
          description: Ride created successfully
          schema:
            additionalProperties: true
            type: object
        "400":
          description: Invalid request
          schema:
            $ref: '#/definitions/handler.ErrorResponse'
        "401":
          description: Unauthorized
          schema:
            $ref: '#/definitions/handler.ErrorResponse'
        "500":
          description: Internal server error
          schema:
            $ref: '#/definitions/handler.ErrorResponse'
      security:
      - BearerAuth: []
      summary: Request a new ride
      tags:
      - Rides
  /rides/accept:
    post:
      consumes:
      - application/json
      description: Driver accepts a ride request
      parameters:
      - description: Ride ID to accept
        in: query
        name: ride_id
        required: true
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: Ride accepted successfully
          schema:
            $ref: '#/definitions/handler.MessageResponse'
        "400":
          description: Invalid request
          schema:
            $ref: '#/definitions/handler.ErrorResponse'
        "401":
          description: Unauthorized
          schema:
            $ref: '#/definitions/handler.ErrorResponse'
      security:
      - BearerAuth: []
      summary: Accept a ride request
      tags:
      - Rides
  /rides/cancel:
    post:
      consumes:
      - application/json
      description: Cancel an active or pending ride
      parameters:
      - description: Ride ID to cancel
        in: query
        name: ride_id
        required: true
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: Ride cancelled successfully
          schema:
            $ref: '#/definitions/handler.MessageResponse'
        "400":
          description: Invalid request
          schema:
            $ref: '#/definitions/handler.ErrorResponse'
      security:
      - BearerAuth: []
      summary: Cancel a ride
      tags:
      - Rides
  /rides/complete:
    post:
      consumes:
      - application/json
      description: Mark a ride as completed
      parameters:
      - description: Ride ID to complete
        in: query
        name: ride_id
        required: true
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: Ride completed successfully
          schema:
            $ref: '#/definitions/handler.MessageResponse'
        "400":
          description: Invalid request
          schema:
            $ref: '#/definitions/handler.ErrorResponse'
      security:
      - BearerAuth: []
      summary: Complete a ride
      tags:
      - Rides
  /rides/details:
    get:
      consumes:
      - application/json
      description: Get detailed information about a specific ride including customer
        info
      parameters:
      - description: Ride ID
        in: query
        name: ride_id
        required: true
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: Ride details with customer information
          schema:
            $ref: '#/definitions/service.RideWithCustomerInfo'
        "400":
          description: Invalid request
          schema:
            $ref: '#/definitions/handler.ErrorResponse'
        "401":
          description: Unauthorized
          schema:
            $ref: '#/definitions/handler.ErrorResponse'
        "404":
          description: Ride not found
          schema:
            $ref: '#/definitions/handler.ErrorResponse'
        "500":
          description: Internal server error
          schema:
            $ref: '#/definitions/handler.ErrorResponse'
      security:
      - BearerAuth: []
      summary: Get ride details
      tags:
      - Rides
  /rides/nearby:
    post:
      consumes:
      - application/json
      description: Driver polls this endpoint to get available rides within a radius.
        Returns rides with status "requested" or "pending" updated within last 5 minutes.
      parameters:
      - description: Driver location and search parameters
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/handler.GetNearbyRidesRequest'
      produces:
      - application/json
      responses:
        "200":
          description: List of nearby available rides
          schema:
            items:
              $ref: '#/definitions/domain.Ride'
            type: array
        "400":
          description: Invalid request parameters
          schema:
            $ref: '#/definitions/handler.ErrorResponse'
        "401":
          description: Unauthorized - driver must be logged in
          schema:
            $ref: '#/definitions/handler.ErrorResponse'
        "500":
          description: Internal server error
          schema:
            $ref: '#/definitions/handler.ErrorResponse'
      security:
      - BearerAuth: []
      summary: Get nearby available rides for driver
      tags:
      - Rides
  /rides/start:
    post:
      consumes:
      - application/json
      description: Mark a ride as started
      parameters:
      - description: Ride ID to start
        in: query
        name: ride_id
        required: true
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: Ride started successfully
          schema:
            $ref: '#/definitions/handler.MessageResponse'
        "400":
          description: Invalid request
          schema:
            $ref: '#/definitions/handler.ErrorResponse'
      security:
      - BearerAuth: []
      summary: Start a ride
      tags:
      - Rides
  /rides/status:
    get:
      consumes:
      - application/json
      description: Get current status of a ride including driver information and location
        if driver has accepted
      parameters:
      - description: Ride ID
        in: query
        name: ride_id
        required: true
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: Ride status with driver information
          schema:
            $ref: '#/definitions/handler.RideStatusResponse'
        "400":
          description: Invalid request
          schema:
            $ref: '#/definitions/handler.ErrorResponse'
        "401":
          description: Unauthorized
          schema:
            $ref: '#/definitions/handler.ErrorResponse'
        "403":
          description: Forbidden - not your ride
          schema:
            $ref: '#/definitions/handler.ErrorResponse'
        "404":
          description: Ride not found
          schema:
            $ref: '#/definitions/handler.ErrorResponse'
        "500":
          description: Internal server error
          schema:
            $ref: '#/definitions/handler.ErrorResponse'
      security:
      - BearerAuth: []
      summary: Get ride status for customer
      tags:
      - Rides
securityDefinitions:
  BearerAuth:
    description: Type "Bearer" followed by a space and JWT token.
    in: header
    name: Authorization
    type: apiKey
swagger: "2.0"
